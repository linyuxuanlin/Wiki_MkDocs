---
id: 直流有刷电机驱动的设计
title: 直流有刷电机驱动的设计
---

通常我们使用 PWM 控制 H 桥电路，实现对直流有刷电机转向和转速的控制，且 PWM 占空比与电机的转速成正比。

## H 桥的基础知识

H 桥（H-Bridge）是一种可以快速切换负载上电压极性的桥式电路。这种电路通常用于驱动直流有刷电机，使其顺时针或者逆时针转。因为其结构看着像字母「H」，所以称其为 H 桥电路。

一个 H 桥由四个开关组成，S1 和 S3 组成 H 桥的高位开关（High-Side Switch），通常是 P 型 MOSFET 或 PNP 型晶体管，S2 和 S4 组成 H 桥的低位开关（Low Side Switch），通常是 N 型 MOSFET 或 NPN 型晶体管。

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20210812093751.png)

- 当开关 S1 和 S4 闭合、S2 和 S3 断开时，电机正常旋转，记为正方向。
- 当开关 S2 和 S3 闭合、S1 和 S4 断开时，电机反向旋转，记为反方向。
- 当开关 S1 和 S2 闭合，或 S3 和 S4 闭合时，电源被短路，有烧毁电源的风险，严禁出现此类情况。这种情况称为射穿（shoot-through）
- 当开关 S1 和 S3 闭合、S2 和 S4 断开；或 S2 和 S4 闭合、S1 和 S3 断开时，电机不旋转。此时电机处于「刹车」状态，电机惯性转动产生的电势将被短路，形成阻碍运动的反电势，形成「刹车」作用。
- 当 S1、S2、S3、S4 四个开关都断开时，电机处于滑行状态，将惯性转动较长时间。

在实际电路中，我们可以使用驱动芯片来对 H 桥 4 个 MOS 管进行精确的控制。

## 选择分立搭建还是集成芯片

相比使用集成驱动芯片，用分立元件搭建电路成本更低、可定制性更强。一般来说，驱动电机首先从 MCU 输出 PWM 信号，经过光耦隔离、逻辑电路后，再到驱动芯片，最后到全桥 / 半桥 MOS 管。

但是，使用分立元件搭建电机驱动，需要注意的事项会比较多，比如死区控制（防止射穿）、控制合适驱动电压、设计保护电路等等，电路设计上的复杂度更高、PCB 占位面积变大、成本变得更高、且设计风险也会提高。

通常来说，驱动直流有刷电机时，我们采用集成 H 桥驱动芯片来实现对直流有刷电机的控制。

## MOS 管的选型

在电机驱动中，我们一般选用增强型 N-MOS 管。原因如下：

1. 选用增强型：其在低电平时可以完全关断，且当电平高于开启电压 $U_{GS(TH)}$ 时，可以完全导通；
2. 选用 N-MOS：因为 P-MOS 型号选择少、价格高、导通电阻大，进而导致高发热和低效率；
3. 选用 MOS 管：MOS 管相比于 BJT，功率损耗更小、体积更小、驱动电流更大、相应更快、导通电阻更小。

实际设计上，为了简化合并物料，我们一般会全部使用 N-MOS。但是由于 N-MOS 不可以直接用于 H 桥高端控制（因为 N-MOS 的导通条件是 $V_g-V_s>V_{gs(th)}$），所以需设计高端浮压自举电路（因为其结构简单），以驱动上管。自举电路的详细介绍，请跳转文章 [**电源设计 - 自举电路**](https://wiki-power.com/%E7%94%B5%E6%BA%90%E8%AE%BE%E8%AE%A1-%E8%87%AA%E4%B8%BE%E7%94%B5%E8%B7%AF)。

N-MOS 选型需注意的参数：

- $V_{DSS}$
- $R_{DS(on)}$

## 集成 H 桥驱动芯片

H 桥驱动芯片一般会将以下的保护电路集成进来：

- 过压保护（Over-Voltage Protection, OVP）
- 欠压锁定保护（Under-Voltage Lock-Out, UVLO）
- 过流保护（Over-Current Protection, OCP）
- 热关机保护（Thermal Shut-Down, TSD）
- 射穿保护（Shoot-Through Protection, STP）
- 静电放电保护（ElectroStatic Discharge, ESD）

一般我们使用门极驱动芯片为高压 / 低压侧功率 N-MOS 管提供驱动栅极的电源（根据数据手册，必须使其高于 MOS 管的 $U_{GS(TH)}$，漏极 D 和源极 S 之间才能导通）。举个例子，下图是 DRV8701 门极驱动的参数：

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20210811095012.png)

配合 IRFH8330 使用，可以带得动这个 MOS 管：

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20210811095429.png)

## PWM 频率的选择

使用 PWM 信号控制电机速度时，需要注意其频率。若频率过低，电机在低速时会产生噪音，而且对占空比的变化也会显得反应迟缓。而如果 PWM 的频率过高，会在 H 桥的 MOSFET 上产生较大的开关损耗。

如果 H 桥驱动芯片的规格书中没有给出具体频率范围的话，一般来说 4kHz-200kHz 左右的 PWM 信号都可以较理想地控制电机的转速。

## 死区时间插入和交叉传导（直通）保护

死区可以简单理解为一个延时，使正转时导通的上桥完全关断时再打开反转时需要打开的下桥。死区过小会导致危险，死区过大会导致电机响应不好，电源的利用效率低等问题。

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20210815112048.jpg)

使用集成方案：纳入自动握手，以便利用最佳的死区时间，而不受回转率、电压、MOS 特性和温度的影响。握手是一个多步骤的过程，确保利用最佳的死区时间，并且不发生交叉传导。握手的过程：

1. 接收信号，以从高端 MOS 到低压侧 MOS
2. 禁用高端 MOS，并监测 $V_{GS}$ 以确定什么时候禁用它
3. 插入死区时间，启用低压侧 MOS

## H 桥的衰减模式

衰减模式，是指走哪个续流回路，使电机停下来。因为直流电机属于感性负载（电感电流不能突变），想让电机停下，除了断开供电，还需要形成一个续流的回路，释放掉电机上的能量，否则电机产生的续流有可能损坏 MOS 管。

### 异步与同步衰减

我们可以使用二极管来构建续流回路，如图：

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20211222162216.png)

而我们知道，MOS 管内本身有体二极管可以充当续流回路，在有些应用中，也会外加并联肖特基二极管，所以可以借其实现续流衰减。用二极管实现衰减的模式被称为异步衰减。但异步衰减的损耗会相对大（$2*I*V_D$），所以我们引出另一种衰减途径，叫同步衰减。同步衰减是通过打开 MOS 管实现续流。因为 MOS 管的导通电阻 $R_{ds(on)}$ 小，所以同步衰减损耗会相对小（$I^2*R_{ds(on)*2}$），下面将主要讲解同步衰减。

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20211222172558.png)

### 关键参数

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20211222172913.png)

- $I_{TRIP}$：当前驱动芯片设定的电流，受驱动算法控制；
- $T_{DRIVE}$：驱动阶段的时间
- $T_{BLANK}$：死区阶段时间，为了防止射穿
- $T_{OFF}$：续流阶段

### 同步衰减的三种模式

同步衰减有三种模式：快衰减（Fast Decay）、慢衰减（Slow Decay）和混合衰减（Mixed Decay）。这里的快慢指的是续流期间电流衰减的相对速度，而非电机的转速。

三种模式的区别：

|                        | 快衰减                       | 慢衰减                   | 混合衰减               |
| ---------------------- | ---------------------------- | ------------------------ | ---------------------- |
| 相电流纹波             | 大                           | 小                       | 适中                   |
| 续流阶段时间 $T_{OFF}$ | 短（可能导致更大的开关损耗） | 长（可能会听到低频噪音） | 适中（频率和性能均衡） |
| 相电流下降速度         | 快                           | 慢                       | 适中                   |
| 适用范围               | 适用于大电感电机             | 适用于小电感电机         | 适中                   |

#### 快衰减

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20211223154627.png)

快衰减的过程是，关闭驱动的两个 MOS 管，等待死区时间过后，打开斜对称的两个 MOS 管，让电流快速消耗掉。在死区时间内，H 桥仍会经历异步衰减，但时间短可忽略。

#### 慢衰减

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20211223160616.png)

慢衰减的过程是，关闭驱动的两个 MOS 管，等待死区时间过后，打开两个下管，让电流慢慢消耗掉。同样的，在死区时间内，H 桥仍会经历异步衰减，但时间短可忽略。

#### 混合衰减

混合衰减的过程是，关闭驱动的两个 MOS 管，等待死区时间过后，打开斜对称的两个 MOS 管（快衰减），让电流快速消耗；再打开两个下管（慢衰减），让电流慢慢消耗掉。混合衰减模式下相电流的纹波介于快衰减和慢衰减之间。

## 电机驱动的 EMC 问题与处理

因为直流电机属于感性负载（电感电流不能突变），为了防止 H 桥关闭输出时电机电压上出现不稳定的反弹或尖峰，可在电机电压源上放置一个大电容（>100μF，一般选用铝电解电容），用于吸收直流电动机制动时产生的飞轮电流，并在电机切换正反转时稳定电机电压源。

另外一个问题是，电机电压源与电机驱动板电源线之间的寄生电抗（电感+电阻）与 PCB 的寄生电容组成一个 LC 谐振槽，在电机电压源向电机驱动板送电时，如果局部旁路电容不足，电机电压可能会迅速下降，寄生 LC 会被触发，出现振荡尖峰。为了减少电源线 LC 谐振引起的尖峰，可在电机 H 桥驱动芯片的电源引脚附近放置一个 0.1μF 的旁路电容（一般选用陶瓷电容）。

一个参考例子：

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20211222150738.png)

另外，可在电机线上加磁环，减少共模干扰（实测明显）。

## 参考与致谢

- [4 个 N-MOS 组成的全桥驱动电路](https://www.fanyedu.com/content/90.html)
- [详解关于 ROBOCON 比赛中有刷电机设计](https://zhuanlan.zhihu.com/p/27547384)
- [浅谈直流有刷电机的驱动电路](https://haipeng.me/2021/02/28/h-bridge-driver/)
- [Slow, Mixed and Fast Decay Modes. Why Do We Need To Complicate Things?](https://ebldc.com/?p=86)
- [精通电机驱动的电流续流、衰减模式和刹车](https://www.ti.com.cn/cn/lit/an/zhcaa31/zhcaa31.pdf)
- [Current Recirculation and Decay Modes](https://www.ti.com/lit/an/slva321a/slva321a.pdf)

> 本篇文章受 [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by/4.0/deed.zh) 协议保护，转载请注明出处。

